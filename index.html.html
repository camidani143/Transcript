<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Transcriber with DeepSeek</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --refresh: #6c5ce7;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 2rem;
            color: var(--dark);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            padding: 2rem;
        }
        
        h1 {
            text-align: center;
            color: var(--secondary);
            margin-bottom: 1.5rem;
            font-weight: 600;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        #startBtn {
            background: var(--primary);
            color: white;
        }
        
        #stopBtn {
            background: var(--danger);
            color: white;
        }
        
        #deepseekBtn {
            background: var(--success);
            color: var(--dark);
        }
        
        #refreshBtn {
            background: var(--refresh);
            color: white;
        }
        
        button:disabled {
            background: #adb5bd !important;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .transcript-container, .deepseek-container {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .transcript-header, .deepseek-header {
            background: var(--secondary);
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }
        
        #transcript, #deepseekResponse {
            height: 200px;
            padding: 20px;
            overflow-y: auto;
            line-height: 1.7;
            background: white;
            font-size: 16px;
        }
        
        .status {
            text-align: center;
            margin: 1rem 0;
            font-size: 14px;
            color: #6c757d;
        }
        
        .word-count {
            background: white;
            color: var(--secondary);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Custom scrollbar */
        #transcript::-webkit-scrollbar,
        #deepseekResponse::-webkit-scrollbar {
            width: 8px;
        }
        
        #transcript::-webkit-scrollbar-track,
        #deepseekResponse::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        #transcript::-webkit-scrollbar-thumb,
        #deepseekResponse::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Audio Transcriber with DeepSeek</h1>
        
        <div class="button-group">
            <button id="startBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
                Start Listening
            </button>
            <button id="stopBtn" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="6" y="4" width="4" height="16"></rect>
                    <rect x="14" y="4" width="4" height="16"></rect>
                </svg>
                Stop
            </button>
            <button id="deepseekBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                Send to DeepSeek
            </button>
            <button id="refreshBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <polyline points="1 20 1 14 7 14"></polyline>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
                Clear All
            </button>
        </div>
        
        <div class="transcript-container">
            <div class="transcript-header">
                <span>Live Transcription</span>
                <span class="word-count" id="wordCount">0 words</span>
            </div>
            <div id="transcript">Click "Start Listening" to begin transcription...</div>
        </div>
        
        <div class="deepseek-container">
            <div class="deepseek-header">
                <span>DeepSeek Response</span>
            </div>
            <div id="deepseekResponse">DeepSeek response will appear here...</div>
        </div>
        
        <div class="status" id="status">Ready to start</div>
    </div>

    <script>
        // DOM Elements
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const deepseekBtn = document.getElementById('deepseekBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const transcriptDiv = document.getElementById('transcript');
        const deepseekDiv = document.getElementById('deepseekResponse');
        const statusDiv = document.getElementById('status');
        const wordCountDiv = document.getElementById('wordCount');
        
        // State variables
        let recognition;
        let finalTranscript = '';
        let isListening = false;
        const DEEPSEEK_API_KEY = 'sk-fe060e6a06804998805406dde9483ae6'; // Your API key

        // Initialize Speech Recognition
        function initSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window)) {
                statusDiv.textContent = "⚠️ Your browser doesn't support speech recognition. Try Chrome or Edge.";
                startBtn.disabled = true;
                return null;
            }
            
            return new window.webkitSpeechRecognition();
        }

        // Set up recognition parameters
        function setupRecognition(recognition) {
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isListening = true;
                startBtn.disabled = true;
                stopBtn.disabled = false;
                statusDiv.textContent = "Listening... Speak now!";
                transcriptDiv.innerHTML = 'Listening for speech...';
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + '\n';
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                transcriptDiv.innerHTML = finalTranscript + (interimTranscript ? `<div style="color:#6c757d;font-style:italic">${interimTranscript}</div>` : '');
                transcriptDiv.scrollTop = transcriptDiv.scrollHeight;
                updateWordCount();
            };

            recognition.onerror = (event) => {
                statusDiv.textContent = `Error: ${event.error}`;
                stopListening();
            };

            recognition.onend = () => {
                if (isListening) {
                    recognition.start();
                }
            };
        }

        function startListening() {
            if (!recognition) {
                recognition = initSpeechRecognition();
                if (!recognition) return;
                setupRecognition(recognition);
            }
            
            try {
                recognition.start();
            } catch (e) {
                statusDiv.textContent = "Error starting microphone. Please refresh and try again.";
                console.error("Recognition start error:", e);
            }
        }

        function stopListening() {
            isListening = false;
            if (recognition) {
                recognition.stop();
            }
            startBtn.disabled = false;
            stopBtn.disabled = true;
            statusDiv.textContent = finalTranscript ? "Ready to continue" : "Ready to start";
        }

        function updateWordCount() {
            const count = finalTranscript.trim() ? finalTranscript.trim().split(/\s+/).length : 0;
            wordCountDiv.textContent = `${count} word${count !== 1 ? 's' : ''}`;
        }

        function refreshAll() {
            // Stop listening if active
            if (isListening) {
                stopListening();
            }
            
            // Clear all text
            finalTranscript = '';
            transcriptDiv.innerHTML = 'Click "Start Listening" to begin transcription...';
            deepseekDiv.innerHTML = 'DeepSeek response will appear here...';
            wordCountDiv.textContent = '0 words';
            statusDiv.textContent = 'Ready to start';
            
            // Show feedback
            const originalText = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '<span>✓ Cleared!</span>';
            setTimeout(() => {
                refreshBtn.innerHTML = originalText;
            }, 2000);
        }

        async function sendToDeepSeek() {
            if (!finalTranscript.trim()) {
                statusDiv.textContent = "No text to send to DeepSeek!";
                return;
            }
            
            // Word limit check
            if (finalTranscript.split(' ').length > 500) {
                statusDiv.textContent = "Maximum 500 words for DeepSeek analysis";
                return;
            }
            
            statusDiv.textContent = "Sending to DeepSeek...";
            deepseekDiv.textContent = "Processing...";
            
            try {
                const response = await fetch('https://api.deepseek.com/v1/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{
                            role: "user",
                            content: finalTranscript
                        }],
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                deepseekDiv.innerHTML = data.choices[0].message.content.replace(/\n/g, '<br>');
                statusDiv.textContent = "DeepSeek response received!";
            } catch (error) {
                console.error("DeepSeek API error:", error);
                deepseekDiv.textContent = "Error: " + (error.message || "Failed to get response");
                statusDiv.textContent = "API request failed";
            }
        }

        // Event Listeners
        startBtn.addEventListener('click', startListening);
        stopBtn.addEventListener('click', stopListening);
        deepseekBtn.addEventListener('click', sendToDeepSeek);
        refreshBtn.addEventListener('click', refreshAll);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            recognition = initSpeechRecognition();
            if (recognition) {
                setupRecognition(recognition);
            }
        });
    </script>
</body>
</html>